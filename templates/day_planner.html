{% extends "base.html" %}

{% block title %}Day Planner - Website Organizer{% endblock %}

{% block content %}
<div class="page">
    <div class="page-header">
        <h1>ğŸ“… Day Planner</h1>
        <button class="btn btn-primary" onclick="toggleModal('addTaskModal')">+ Add Task</button>
    </div>

    <!-- Date Selector -->
    <div class="date-selector">
        <button class="btn btn-sm" onclick="changeDate(-1)">â† Previous Day</button>
        <input type="date" id="dateSelector" value="{{ selected_date }}" onchange="selectDate(this.value)">
        <button class="btn btn-sm" onclick="changeDate(1)">Next Day â†’</button>
        <button class="btn btn-sm" onclick="selectToday()">Today</button>
    </div>

    <!-- Daily Summary -->
    <div class="daily-summary">
        <div class="summary-card">
            <div class="summary-icon">ğŸ“</div>
            <div class="summary-info">
                <h3>{{ stats.total }}</h3>
                <p>Total Tasks</p>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">âœ…</div>
            <div class="summary-info">
                <h3>{{ stats.completed }}</h3>
                <p>Completed</p>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">ğŸ¯</div>
            <div class="summary-info">
                <h3>{{ stats.pending }}</h3>
                <p>Pending</p>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">âš¡</div>
            <div class="summary-info">
                <h3>{{ stats.high_priority }}</h3>
                <p>High Priority</p>
            </div>
        </div>
    </div>

    <!-- Time Slots -->
    <div class="timeline">
        <h2>ğŸ“‹ Daily Schedule - {{ selected_date }}</h2>
        
        {% if tasks %}
        <div class="tasks-container">
            {% for task in tasks %}
            <div class="task-card priority-{{ task.priority }} status-{{ task.status }}">
                <div class="task-time">
                    <span class="time-badge">{{ task.start_time.strftime('%H:%M') }}</span>
                    {% if task.end_time %}
                    <span class="time-badge">{{ task.end_time.strftime('%H:%M') }}</span>
                    {% endif %}
                </div>
                <div class="task-content">
                    <div class="task-header">
                        <h3>{{ task.title }}</h3>
                        <div class="task-badges">
                            <span class="priority-badge priority-{{ task.priority }}">{{ task.priority }}</span>
                            <span class="status-badge status-{{ task.status }}">{{ task.status }}</span>
                        </div>
                    </div>
                    {% if task.description %}
                    <p class="task-description">{{ task.description }}</p>
                    {% endif %}
                    {% if task.category %}
                    <span class="category-tag">ğŸ·ï¸ {{ task.category }}</span>
                    {% endif %}

                </div>
                <div class="task-actions">
                    <select class="status-select-mini" onchange="updateTaskStatus({{ task.id }}, this.value)">
                        <option value="pending" {% if task.status == 'pending' %}selected{% endif %}>Pending</option>
                        <option value="in_progress" {% if task.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                        <option value="completed" {% if task.status == 'completed' %}selected{% endif %}>Completed</option>
                    </select>
                    <button class="btn-icon" onclick="editTask({{ task.id }})">âœï¸</button>
                    <button class="btn-icon" onclick="deleteTask({{ task.id }})">ğŸ—‘ï¸</button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <h3>No tasks scheduled for this day</h3>
            <p>Start planning your day by adding tasks</p>
        </div>
        {% endif %}
    </div>

    <!-- Today's Related Submissions -->
    {% if submissions_today %}
    <div class="section">
        <h2>ğŸ”” Related Submissions Due Today</h2>
        <div class="related-submissions">
            {% for sub in submissions_today %}
            <div class="submission-alert">
                <span class="alert-icon">âš ï¸</span>
                <div class="alert-content">
                    <strong>{{ sub.title }}</strong> - {{ sub.website.name }}
                    <br><small>Due: {{ sub.due_date.strftime('%H:%M') }}</small>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Add Task Modal -->
<div id="addTaskModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="toggleModal('addTaskModal')">&times;</span>
        <h2>Add New Task</h2>
        <form action="/add_day_plan" method="POST">
            <input type="hidden" name="date" id="taskDate" value="{{ selected_date }}">
            
            <div class="form-group">
                <label for="task_title">Task Title *</label>
                <input type="text" id="task_title" name="task_title" required placeholder="e.g., Morning Meeting">
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="3" placeholder="Task details..."></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start_time">Start Time *</label>
                    <input type="time" id="start_time" name="start_time" required>
                </div>
                <div class="form-group">
                    <label for="end_time">End Time</label>
                    <input type="time" id="end_time" name="end_time">
                </div>
            </div>
            
            <div class="form-group">
                <label for="category">Category</label>
                <select id="category" name="category">
                    <option value="">Select Category</option>
                    <option value="work">Work</option>
                    <option value="personal">Personal</option>
                    <option value="meeting">Meeting</option>
                    <option value="study">Study</option>
                    <option value="exercise">Exercise</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="priority">Priority *</label>
                <select id="priority" name="priority" required>
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            
            <button type="submit" class="btn btn-primary">Add Task</button>
        </form>
    </div>
</div>

<script>
// Date navigation
function selectDate(date) {
    window.location.href = '/day-planner?date=' + date;
}

function changeDate(days) {
    const currentDate = new Date('{{ selected_date }}');
    currentDate.setDate(currentDate.getDate() + days);
    const newDate = currentDate.toISOString().split('T')[0];
    selectDate(newDate);
}

function selectToday() {
    const today = new Date().toISOString().split('T')[0];
    selectDate(today);
}

// Update task status
function updateTaskStatus(taskId, status) {
    fetch(`/update_day_plan_status/${taskId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ status: status })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    })
    .catch(error => console.error('Error:', error));
}

// Delete task
function deleteTask(taskId) {
    if (confirm('Are you sure you want to delete this task?')) {
        fetch(`/delete_day_plan/${taskId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        })
        .catch(error => console.error('Error:', error));
    }
}

// Edit task (placeholder for future enhancement)
function editTask(taskId) {
    alert('Edit functionality coming soon!');
}

// Set current date in modal
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('taskDate').value = '{{ selected_date }}';
});
</script>
{% endblock %}
